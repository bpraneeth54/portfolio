<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Portal | Praneeth Reddy Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:#0a0e27;color:#e0e7ff;overflow-x:hidden;}
.login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0a0e27,#1a1f3a);padding:20px;}
.login-box{background:rgba(30,41,59,0.8);border:1px solid rgba(6,182,212,0.2);border-radius:15px;padding:50px;width:100%;max-width:450px;box-shadow:0 20px 60px rgba(0,0,0,0.4);}
.login-box h1{font-family:'Space Grotesk',sans-serif;margin-bottom:10px;background:linear-gradient(135deg,#06b6d4,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.login-box p{color:#cbd5e1;margin-bottom:30px;opacity:0.8;}
.admin-container{max-width:1400px;margin:0 auto;padding:30px 20px;display:none;}
.admin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:40px;padding:20px;background:linear-gradient(135deg,rgba(6,182,212,0.1),rgba(139,92,246,0.1));border-radius:12px;border:1px solid rgba(6,182,212,0.2);}
.tabs{display:flex;gap:10px;margin-bottom:30px;border-bottom:1px solid rgba(6,182,212,0.1);padding-bottom:15px;flex-wrap:wrap;}
.tab-btn{padding:12px 25px;background:transparent;border:none;color:#cbd5e1;cursor:pointer;font-weight:600;transition:all 0.3s;border-bottom:3px solid transparent;}
.tab-btn.active{color:#06b6d4;border-bottom-color:#06b6d4;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.section{background:rgba(30,41,59,0.5);border:1px solid rgba(6,182,212,0.1);border-radius:12px;padding:30px;margin-bottom:30px;}
.section h3{color:#06b6d4;margin-bottom:20px;margin-top:0;font-size:1.3rem;}
.form-group{margin-bottom:20px;}
label{display:block;margin-bottom:8px;font-weight:600;color:#e0e7ff;font-size:0.9rem;}
input,textarea{width:100%;padding:12px;background:rgba(15,23,42,0.6);border:1px solid rgba(6,182,212,0.2);border-radius:6px;color:#e0e7ff;font-family:'Inter',sans-serif;transition:all 0.3s;}
input:focus,textarea:focus{outline:none;border-color:#06b6d4;box-shadow:0 0 15px rgba(6,182,212,0.2);}
textarea{resize:vertical;min-height:100px;}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:20px;}
.array-item{background:rgba(15,23,42,0.4);padding:20px;border-radius:8px;margin-bottom:15px;border-left:3px solid #06b6d4;}
.btn-primary{background:linear-gradient(135deg,#06b6d4,#0891b2);color:#fff;padding:12px 30px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s;}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(6,182,212,0.3);}
.btn-secondary{background:transparent;border:2px solid #06b6d4;color:#06b6d4;padding:10px 20px;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s;}
.btn-secondary:hover{background:rgba(6,182,212,0.1);}
.btn-danger{background:#dc2626;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s;}
.btn-danger:hover{background:#991b1b;}
.btn-group{display:flex;gap:10px;margin-top:20px;flex-wrap:wrap;}
.error{background:rgba(220,38,38,0.1);border:1px solid #dc2626;color:#fca5a5;padding:12px;border-radius:6px;margin-bottom:20px;display:none;}
.success{background:rgba(34,197,94,0.1);border:1px solid #22c55e;color:#86efac;padding:15px;border-radius:6px;margin-bottom:20px;display:none;}
.message-item{background:rgba(15,23,42,0.4);padding:20px;border-radius:8px;margin-bottom:15px;border-left:3px solid #06b6d4;}
.message-item strong{color:#06b6d4;}
.message-item small{color:#94a3b8;display:block;margin-top:10px;}
.messages-list{max-height:500px;overflow-y:auto;}
.section-item{background:rgba(30,41,59,0.5);padding:15px;border-radius:6px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;}
.logout-btn{background:#dc2626;color:#fff;padding:10px 25px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s;}
.logout-btn:hover{background:#991b1b;transform:translateY(-2px);}
@media(max-width:768px){.grid-2{grid-template-columns:1fr;}.admin-header{flex-direction:column;gap:15px;}.tabs{overflow-x:auto;white-space:nowrap;}}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
    <div class="login-box">
        <h1><i class="fas fa-lock"></i> Admin Portal</h1>
        <p>Enter your password to access the dashboard</p>
        <div class="error" id="errorMsg"></div>
        <div class="form-group">
            <label for="adminPassword">Password</label>
            <input type="password" id="adminPassword" placeholder="Enter admin password" onkeypress="if(event.key==='Enter') loginAdmin()">
        </div>
        <button class="btn-primary" style="width:100%;" onclick="loginAdmin()"><i class="fas fa-sign-in-alt"></i> Login</button>
        <p style="text-align:center;margin-top:20px;font-size:0.9rem;opacity:0.6;">Default: <code style="color:#06b6d4;">admin</code></p>
    </div>
</div>

<!-- ADMIN DASHBOARD -->
<div class="admin-container" id="adminContainer">
    <div class="admin-header">
        <h2 style="margin:0;background:linear-gradient(135deg,#06b6d4,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;"><i class="fas fa-cog"></i> Portfolio Admin</h2>
        <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>

    <div class="success" id="successMsg">✓ Changes saved successfully!</div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(event,'profile')"><i class="fas fa-user"></i> Profile</button>
        <button class="tab-btn" onclick="switchTab(event,'skills')"><i class="fas fa-star"></i> Skills</button>
        <button class="tab-btn" onclick="switchTab(event,'projects')"><i class="fas fa-briefcase"></i> Projects</button>
        <button class="tab-btn" onclick="switchTab(event,'certs')"><i class="fas fa-certificate"></i> Certifications</button>
        <button class="tab-btn" onclick="switchTab(event,'sections')"><i class="fas fa-plus-square"></i> Sections</button>
        <button class="tab-btn" onclick="switchTab(event,'messages')"><i class="fas fa-envelope"></i> Messages</button>
        <button class="tab-btn" onclick="switchTab(event,'security')"><i class="fas fa-key"></i> Security</button>
    </div>

    <!-- PROFILE TAB -->
    <div id="profile" class="tab-content active">
        <div class="section">
            <h3>Hero Section</h3>
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="heroName" placeholder="Your Name">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="heroDesc" placeholder="Your professional description..."></textarea>
            </div>
            <div class="form-group">
                <label>Profile Image URL</label>
                <input type="text" id="heroImage" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>Upload Profile Photo</label>
                <input type="file" id="heroUpload" accept="image/*">
                <div style="margin-top:12px;display:flex;gap:12px;align-items:center;">
                    <img id="heroPreview" src="assets/profile.svg" alt="preview" style="width:80px;height:80px;border-radius:10px;border:1px solid rgba(6,182,212,0.12);object-fit:cover;">
                    <small style="opacity:0.8;">Choose an image to upload; it will be saved locally.</small>
                </div>
            </div>
            <button class="btn-primary" onclick="saveProfile()"><i class="fas fa-save"></i> Save Profile</button>
        </div>

        <div class="section">
            <h3>About Section</h3>
            <div class="form-group">
                <label>About Text</label>
                <textarea id="aboutText" placeholder="Tell about yourself..."></textarea>
            </div>
            <button class="btn-primary" onclick="saveProfile()"><i class="fas fa-save"></i> Save About</button>
        </div>

        <div class="section">
            <h3><i class="fas fa-file-pdf"></i> Resume Management</h3>
            <div class="form-group">
                <label>Upload Resume (PDF only, max 5MB)</label>
                <input type="file" id="resumeUpload" accept=".pdf,application/pdf">
                <div style="margin-top:12px;padding:15px;background:rgba(6,182,212,0.08);border-radius:8px;border:1px solid rgba(6,182,212,0.2);">
                    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                        <div style="flex:1;min-width:200px;">
                            <div id="resumeStatus" style="color:#94a3b8;font-size:0.9rem;">
                                <i class="fas fa-info-circle"></i> No resume uploaded yet
                            </div>
                            <div id="resumeInfo" style="display:none;margin-top:8px;">
                                <div style="color:#06b6d4;font-weight:600;margin-bottom:4px;" id="resumeName"></div>
                                <div style="color:#94a3b8;font-size:0.85rem;" id="resumeSize"></div>
                            </div>
                        </div>
                        <div style="display:flex;gap:8px;flex-wrap:wrap;">
                            <button class="btn-secondary" id="viewResumeBtn" onclick="viewResume()" style="display:none;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn-secondary" id="downloadResumeBtn" onclick="downloadResume()" style="display:none;">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn-danger" id="deleteResumeBtn" onclick="deleteResume()" style="display:none;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
                <small style="display:block;margin-top:8px;opacity:0.7;">
                    <i class="fas fa-lightbulb"></i> Tip: This resume will be available for download on your portfolio
                </small>
            </div>
        </div>
    </div>

    <!-- SKILLS TAB -->
    <div id="skills" class="tab-content">
        <div class="section">
            <h3>Technical Skills</h3>
            <div id="skillsList"></div>
            <div class="btn-group">
                <button class="btn-secondary" onclick="addItem('skill')"><i class="fas fa-plus"></i> Add Skill</button>
                <button class="btn-primary" onclick="saveItems('skill')"><i class="fas fa-save"></i> Save Skills</button>
            </div>
        </div>
    </div>

    <!-- PROJECTS TAB -->
    <div id="projects" class="tab-content">
        <div class="section">
            <h3>Portfolio Projects</h3>
            <div id="projectsList"></div>
            <div class="btn-group">
                <button class="btn-secondary" onclick="addItem('project')"><i class="fas fa-plus"></i> Add Project</button>
                <button class="btn-primary" onclick="saveItems('project')"><i class="fas fa-save"></i> Save Projects</button>
            </div>
        </div>
    </div>

    <!-- CERTIFICATIONS TAB -->
    <div id="certs" class="tab-content">
        <div class="section">
            <h3>Certifications</h3>
            <div id="certsList"></div>
            <div class="btn-group">
                <button class="btn-secondary" onclick="addItem('cert')"><i class="fas fa-plus"></i> Add Cert</button>
                <button class="btn-primary" onclick="saveItems('cert')"><i class="fas fa-save"></i> Save Certs</button>
            </div>
        </div>
    </div>

    <!-- CUSTOM SECTIONS TAB -->
    <div id="sections" class="tab-content">
        <div class="section">
            <h3>Custom Menu Sections</h3>
            <p style="margin-bottom:20px;opacity:0.8;">Add or remove custom sections from your portfolio menu</p>
            <div id="sectionsList"></div>
            <div style="margin-top:20px;padding:20px;background:rgba(6,182,212,0.1);border-radius:8px;">
                <label>Add New Section</label>
                <input type="text" id="newSectionName" placeholder="e.g., Blog, Gallery, Experience">
                <button class="btn-secondary" style="margin-top:10px;" onclick="addCustomSection()"><i class="fas fa-plus"></i> Add Section</button>
            </div>
        </div>
    </div>

    <!-- MESSAGES TAB -->
    <div id="messages" class="tab-content">
        <div class="section">
            <h3>Contact Messages</h3>
            <div class="messages-list" id="messagesList"></div>
            <button class="btn-danger" style="margin-top:20px;" onclick="clearMessages()"><i class="fas fa-trash"></i> Clear All Messages</button>
        </div>
    </div>

    <!-- SECURITY TAB -->
    <div id="security" class="tab-content">
        <div class="section">
            <h3><i class="fas fa-key"></i> Change Admin Password</h3>
            <div class="form-group">
                <label>Current Password</label>
                <input type="password" id="currentPassword" placeholder="Enter current password">
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password">
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
            </div>
            <button class="btn-primary" onclick="updatePassword()"><i class="fas fa-check"></i> Update Password</button>
        </div>

        <div class="section">
            <h3><i class="fas fa-globe"></i> Social Media Links</h3>
            <div class="form-group">
                <label>LinkedIn URL</label>
                <input type="text" id="linkedinUrl" placeholder="https://linkedin.com/in/...">
            </div>
            <div class="form-group">
                <label>GitHub URL</label>
                <input type="text" id="githubUrl" placeholder="https://github.com/...">
            </div>
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="emailAddr" placeholder="your.email@example.com">
            </div>
            <button class="btn-primary" onclick="saveSocial()"><i class="fas fa-save"></i> Save Links</button>
        </div>
    </div>
</div>

<script>
function loginAdmin(){
    const pwd = document.getElementById('adminPassword').value;
    const admin = JSON.parse(localStorage.getItem('adminData')) || {password:'admin'};
    const err = document.getElementById('errorMsg');
    if(pwd === admin.password){
        sessionStorage.setItem('adminLoggedIn','true');
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminContainer').style.display = 'block';
        loadAllData();
    } else {
        err.textContent = '❌ Incorrect password';
        err.style.display = 'block';
        setTimeout(()=>err.style.display='none',3000);
    }
}

function logout(){
    sessionStorage.removeItem('adminLoggedIn');
    window.location.href = 'index.html';
}

window.addEventListener('load',()=>{
    if(sessionStorage.getItem('adminLoggedIn')==='true'){
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('adminContainer').style.display='block';
        loadAllData();
    }
});

function switchTab(e,tab){
    document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(el=>el.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
    e.target.classList.add('active');
}

function getPortfolioData(){
    return JSON.parse(localStorage.getItem('portfolioData')) || {
        hero:{name:'Alex Johnson',description:'Developer'},
        about:'About text',
        skills:[],
        projects:[],
        certifications:[],
        customSections:[]
    };
}

function savePortfolioData(d){localStorage.setItem('portfolioData',JSON.stringify(d));}

function loadAllData(){
    const d=getPortfolioData();
    document.getElementById('heroName').value=d.hero.name||'';
    document.getElementById('heroDesc').value=d.hero.description||'';
    document.getElementById('heroImage').value=d.hero.image||'';
    // preview image (if available)
    const prev=document.getElementById('heroPreview');
    if(prev) prev.src = d.hero.image || 'assets/profile.svg';
    document.getElementById('aboutText').value=d.about||'';
    renderSkills(d.skills);
    renderProjects(d.projects);
    renderCerts(d.certifications);
    renderSections(d.customSections||[]);
    renderMessages();
    const a=JSON.parse(localStorage.getItem('adminData'))||{};
    document.getElementById('linkedinUrl').value=a.linkedin||'';
    document.getElementById('githubUrl').value=a.github||'';
    document.getElementById('emailAddr').value=a.email||'';
}

// Handle file upload for profile image — attach immediately (script may run after DOMContentLoaded)
;(function attachUploadHandler(){
    const upload = document.getElementById('heroUpload');
    if(!upload) return;
    upload.addEventListener('change', function(e){
        const f = this.files && this.files[0];
        if(!f) return;
        // resize + compress to keep dataURL size reasonable
        const img = new Image();
        const reader = new FileReader();
        reader.onload = function(ev){
            img.onload = function(){
                const maxW = 1200;
                const scale = Math.min(1, maxW / img.width);
                const canvas = document.createElement('canvas');
                canvas.width = Math.round(img.width * scale);
                canvas.height = Math.round(img.height * scale);
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                // export as jpeg with quality to reduce size
                const quality = 0.85;
                try {
                    const dataUrl = canvas.toDataURL('image/jpeg', quality);
                    const imgInput = document.getElementById('heroImage');
                    const prev = document.getElementById('heroPreview');
                    if(imgInput) imgInput.value = dataUrl;
                    if(prev) prev.src = dataUrl;
                    // attempt to save and catch quota errors
                    let d = getPortfolioData();
                    d.hero = d.hero || {};
                    d.hero.image = dataUrl;
                    try{
                        savePortfolioData(d);
                    }catch(ex){
                        alert('Failed to save image to localStorage — file may be too large. Try a smaller image.');
                        console.error('localStorage save error', ex);
                    }
                } catch(exportErr){
                    alert('Image processing failed. Try a different image.');
                    console.error('export error', exportErr);
                }
            };
            img.onerror = function(){ alert('Invalid image file'); };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(f);
    });
})();

function renderSkills(s){
    const c=document.getElementById('skillsList');
    c.innerHTML='';
    s.forEach((sk,i)=>{
        c.innerHTML+=`<div class="array-item"><div class="grid-2"><div><label>Skill</label><input value="${sk.name}" onchange="updateArray(${i},'skill','name',this.value)"></div><div><label>%</label><input type="number" value="${sk.progress}" min="0" max="100" onchange="updateArray(${i},'skill','progress',this.value)"></div></div><label>Category</label><input value="${sk.category||'Tech'}" onchange="updateArray(${i},'skill','category',this.value)"><button class="btn-danger" style="margin-top:10px;" onclick="removeArray(${i},'skill')"><i class="fas fa-trash"></i> Remove</button></div>`;
    });
}

function renderProjects(p){
    const c=document.getElementById('projectsList');
    c.innerHTML='';
    p.forEach((pr,i)=>{
        c.innerHTML+=`<div class="array-item"><label>Title</label><input value="${pr.title}" onchange="updateArray(${i},'project','title',this.value)"><label>Description</label><textarea onchange="updateArray(${i},'project','description',this.value)">${pr.description}</textarea><div class="grid-2"><div><label>Icon</label><input value="${pr.icon||''}" onchange="updateArray(${i},'project','icon',this.value)"></div><div><label>Link</label><input value="${pr.link||''}" onchange="updateArray(${i},'project','link',this.value)"></div></div><button class="btn-danger" style="margin-top:10px;" onclick="removeArray(${i},'project')"><i class="fas fa-trash"></i> Remove</button></div>`;
    });
}

function renderCerts(c){
    const el=document.getElementById('certsList');
    el.innerHTML='';
    c.forEach((ct,i)=>{
        el.innerHTML+=`<div class="array-item"><div class="grid-2"><div><label>Title</label><input value="${ct.title}" onchange="updateArray(${i},'cert','title',this.value)"></div><div><label>Issuer</label><input value="${ct.issuer||''}" onchange="updateArray(${i},'cert','issuer',this.value)"></div></div><label>Description</label><textarea onchange="updateArray(${i},'cert','description',this.value)">${ct.description}</textarea><div class="grid-2"><div><label>Icon</label><input value="${ct.icon||'fa-cert'}" onchange="updateArray(${i},'cert','icon',this.value)"></div><div><label>Link</label><input value="${ct.link||''}" onchange="updateArray(${i},'cert','link',this.value)"></div></div><button class="btn-danger" style="margin-top:10px;" onclick="removeArray(${i},'cert')"><i class="fas fa-trash"></i> Remove</button></div>`;
    });
}

function renderSections(s){
    const c=document.getElementById('sectionsList');
    c.innerHTML='<h4 style="margin-bottom:15px;color:#06b6d4;">Active Sections</h4>';
    if(s.length===0)c.innerHTML+='<p style="opacity:0.6;">No custom sections yet</p>';
    else s.forEach((sec,i)=>{c.innerHTML+=`<div class="section-item"><span><i class="fas fa-link"></i> ${sec}</span><button class="btn-danger" style="padding:5px 10px;" onclick="removeSection(${i})"><i class="fas fa-times"></i></button></div>`;});
}

function renderMessages(){
    const m=JSON.parse(localStorage.getItem('contactMessages'))||[];
    const c=document.getElementById('messagesList');
    if(m.length===0){c.innerHTML='<p style="opacity:0.6;">No messages yet</p>';return;}
    c.innerHTML='';
    m.reverse().forEach(msg=>{c.innerHTML+=`<div class="message-item"><strong>${msg.fullName}</strong> &lt;${msg.email}&gt;<p style="margin:10px 0;">${msg.message}</p><small><i class="fas fa-calendar"></i> ${msg.date}</small></div>`;});
}

function updateArray(i,t,f,v){
    let d=getPortfolioData();
    let a=t==='skill'?d.skills:t==='project'?d.projects:d.certifications;
    a[i][f]=f==='progress'?parseInt(v):v;
    savePortfolioData(d);
}

function addItem(t){
    let d=getPortfolioData();
    if(t==='skill')d.skills.push({name:'New',progress:80,category:'Tech'});
    else if(t==='project')d.projects.push({title:'Project',description:'Desc',icon:'',link:''});
    else d.certifications.push({title:'Cert',issuer:'',description:'',icon:'fa-cert',link:''});
    savePortfolioData(d);
    loadAllData();
}

function removeArray(i,t){
    if(!confirm('Remove?'))return;
    let d=getPortfolioData();
    let a=t==='skill'?d.skills:t==='project'?d.projects:d.certifications;
    a.splice(i,1);
    savePortfolioData(d);
    loadAllData();
}

function saveProfile(){
    let d=getPortfolioData();
    d.hero={name:document.getElementById('heroName').value,description:document.getElementById('heroDesc').value,image:document.getElementById('heroImage').value};
    d.about=document.getElementById('aboutText').value;
    savePortfolioData(d);
    showSuccess();
}

function saveItems(t){
    showSuccess();
}

function addCustomSection(){
    const n=document.getElementById('newSectionName').value.trim();
    if(!n){alert('Enter name');return;}
    let d=getPortfolioData();
    d.customSections=d.customSections||[];
    d.customSections.push(n);
    savePortfolioData(d);
    document.getElementById('newSectionName').value='';
    renderSections(d.customSections);
    showSuccess();
}

function removeSection(i){
    if(!confirm('Remove?'))return;
    let d=getPortfolioData();
    d.customSections.splice(i,1);
    savePortfolioData(d);
    renderSections(d.customSections);
    showSuccess();
}

function clearMessages(){
    if(!confirm('Delete all?'))return;
    localStorage.setItem('contactMessages',JSON.stringify([]));
    renderMessages();
    showSuccess();
}

function updatePassword(){
    const c=document.getElementById('currentPassword').value;
    const n=document.getElementById('newPassword').value;
    const cf=document.getElementById('confirmPassword').value;
    const a=JSON.parse(localStorage.getItem('adminData'))||{password:'praneeth@123'};
    if(c!==a.password){alert('Current incorrect');return;}
    if(n.length<4){alert('Min 4 chars');return;}
    if(n!==cf){alert('Mismatch');return;}
    a.password=n;
    localStorage.setItem('adminData',JSON.stringify(a));
    document.getElementById('currentPassword').value='';
    document.getElementById('newPassword').value='';
    document.getElementById('confirmPassword').value='';
    showSuccess();
}

function saveSocial(){
    let a=JSON.parse(localStorage.getItem('adminData'))||{};
    a.linkedin=document.getElementById('linkedinUrl').value;
    a.github=document.getElementById('githubUrl').value;
    a.email=document.getElementById('emailAddr').value;
    localStorage.setItem('adminData',JSON.stringify(a));
    showSuccess();
}

function showSuccess(){
    const m=document.getElementById('successMsg');
    m.style.display='block';
    setTimeout(()=>m.style.display='none',3000);
}

/* =================== RESUME MANAGEMENT =================== */

// Initialize resume upload handler
;(function initResumeUpload(){
    const uploadInput = document.getElementById('resumeUpload');
    if(!uploadInput) return;
    
    uploadInput.addEventListener('change', function(e){
        const file = this.files && this.files[0];
        if(!file) return;
        
        // Validate file type
        if(file.type !== 'application/pdf'){
            alert('Please upload a PDF file only.');
            this.value = '';
            return;
        }
        
        // Validate file size (max 5MB)
        const maxSize = 5 * 1024 * 1024; // 5MB
        if(file.size > maxSize){
            alert('File size must be less than 5MB. Please choose a smaller file.');
            this.value = '';
            return;
        }
        
        // Read and save the file
        const reader = new FileReader();
        reader.onload = function(evt){
            const resumeData = {
                name: file.name,
                size: file.size,
                type: file.type,
                lastModified: file.lastModified,
                data: evt.target.result // base64 data
            };
            
            localStorage.setItem('portfolioResume', JSON.stringify(resumeData));
            uploadInput.value = ''; // Clear input
            updateResumeStatus();
            showSuccess();
        };
        
        reader.onerror = function(){
            alert('Error reading file. Please try again.');
        };
        
        reader.readAsDataURL(file);
    });
    
    // Load initial status
    updateResumeStatus();
})();

function updateResumeStatus(){
    const resume = JSON.parse(localStorage.getItem('portfolioResume'));
    const statusDiv = document.getElementById('resumeStatus');
    const infoDiv = document.getElementById('resumeInfo');
    const viewBtn = document.getElementById('viewResumeBtn');
    const downloadBtn = document.getElementById('downloadResumeBtn');
    const deleteBtn = document.getElementById('deleteResumeBtn');
    
    if(resume && resume.data){
        // Resume exists
        statusDiv.innerHTML = '<i class="fas fa-check-circle" style="color:#10b981;"></i> Resume uploaded successfully';
        infoDiv.style.display = 'block';
        document.getElementById('resumeName').textContent = resume.name;
        document.getElementById('resumeSize').textContent = formatFileSize(resume.size);
        
        viewBtn.style.display = 'inline-block';
        downloadBtn.style.display = 'inline-block';
        deleteBtn.style.display = 'inline-block';
    } else {
        // No resume
        statusDiv.innerHTML = '<i class="fas fa-info-circle"></i> No resume uploaded yet';
        infoDiv.style.display = 'none';
        viewBtn.style.display = 'none';
        downloadBtn.style.display = 'none';
        deleteBtn.style.display = 'none';
    }
}

function formatFileSize(bytes){
    if(bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}

function viewResume(){
    const resume = JSON.parse(localStorage.getItem('portfolioResume'));
    if(!resume || !resume.data){
        alert('No resume to view');
        return;
    }
    
    // Open PDF in new tab
    const byteString = atob(resume.data.split(',')[1]);
    const ab = new ArrayBuffer(byteString.length);
    const ia = new Uint8Array(ab);
    for(let i = 0; i < byteString.length; i++){
        ia[i] = byteString.charCodeAt(i);
    }
    const blob = new Blob([ab], {type: 'application/pdf'});
    const url = URL.createObjectURL(blob);
    window.open(url, '_blank');
    
    // Clean up after a delay
    setTimeout(() => URL.revokeObjectURL(url), 1000);
}

function downloadResume(){
    const resume = JSON.parse(localStorage.getItem('portfolioResume'));
    if(!resume || !resume.data){
        alert('No resume to download');
        return;
    }
    
    // Create download link
    const link = document.createElement('a');
    link.href = resume.data;
    link.download = resume.name || 'resume.pdf';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showSuccess();
}

function deleteResume(){
    if(!confirm('Are you sure you want to delete the resume? This action cannot be undone.')){
        return;
    }
    
    localStorage.removeItem('portfolioResume');
    document.getElementById('resumeUpload').value = '';
    updateResumeStatus();
    showSuccess();
}

</script>
</body>
</html>
